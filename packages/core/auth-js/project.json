{
  "name": "@supabase/auth-js",
  "targets": {
    "test:clean-pre": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx supabase stop --no-backup --workdir test || true",
        "cwd": "{projectRoot}"
      }
    },
    "test:infra": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx supabase start --workdir test",
        "cwd": "{projectRoot}"
      },
      "dependsOn": ["test:clean-pre"]
    },
    "test:suite": {
      "executor": "nx:run-commands",
      "options": {
        "command": "jest --runInBand --coverage --testPathIgnorePatterns=docker-tests",
        "cwd": "{projectRoot}"
      },
      "outputs": ["{projectRoot}/coverage"],
      "dependsOn": ["test:infra"]
    },
    "test:clean-post": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx supabase stop --no-backup --workdir test || true",
        "cwd": "{projectRoot}"
      },
      "dependsOn": ["test:suite"]
    },
    "test:auth": {
      "executor": "nx:run-commands",
      "options": {
        "command": "echo 'Auth-js CLI tests complete'",
        "cwd": "{projectRoot}"
      },
      "dependsOn": ["test:clean-post"],
      "metadata": {
        "description": "Run auth-js CLI tests - core auth functionality (email, OAuth, sessions, MFA, SSO) with coverage report"
      }
    },
    "test:docker:clean-pre": {
      "executor": "nx:run-commands",
      "options": {
        "command": "docker compose -f infra/docker-compose.yml down || true",
        "cwd": "{projectRoot}"
      }
    },
    "test:docker:infra": {
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "docker compose -f infra/docker-compose.yml pull",
          "docker compose -f infra/docker-compose.yml up -d",
          "sleep 30"
        ],
        "cwd": "{projectRoot}",
        "parallel": false
      },
      "dependsOn": ["test:docker:clean-pre"]
    },
    "test:docker:suite": {
      "executor": "nx:run-commands",
      "options": {
        "command": "jest --runInBand --coverage --coverageDirectory=coverage-docker --testPathPattern=docker-tests",
        "cwd": "{projectRoot}"
      },
      "outputs": ["{projectRoot}/coverage-docker"],
      "dependsOn": ["test:docker:infra"]
    },
    "test:docker:clean-post": {
      "executor": "nx:run-commands",
      "options": {
        "command": "docker compose -f infra/docker-compose.yml down",
        "cwd": "{projectRoot}"
      },
      "dependsOn": ["test:docker:suite"]
    },
    "test:docker": {
      "executor": "nx:run-commands",
      "options": {
        "command": "echo 'Auth-js Docker tests complete'",
        "cwd": "{projectRoot}"
      },
      "dependsOn": ["test:docker:clean-post"],
      "metadata": {
        "description": "Run auth-js Docker tests - edge cases requiring custom GoTrue config (signup-disabled, asymmetric-jwt, phone-otp, anonymous-disabled) with separate coverage report"
      }
    },
    "test:merge-coverage": {
      "executor": "nx:run-commands",
      "options": {
        "command": "node merge-coverage.js",
        "cwd": "{projectRoot}"
      },
      "outputs": ["{projectRoot}/coverage-merged"],
      "metadata": {
        "description": "Merge coverage reports from CLI and Docker test suites into a single report"
      }
    },
    "test:all": {
      "executor": "nx:run-commands",
      "options": {
        "commands": ["nx test:auth auth-js", "nx test:docker auth-js", "node merge-coverage.js"],
        "cwd": "{projectRoot}",
        "parallel": false
      },
      "metadata": {
        "description": "Run both CLI and Docker test suites, then merge coverage reports"
      }
    }
  }
}

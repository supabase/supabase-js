# Check code formatting
echo "ğŸ” Checking code formatting..."
npx nx format:check --verbose

echo "âœ… Code formatting check passed"

# Check if postgrest-js test database schema was modified
if git diff --name-only origin/master...HEAD 2>/dev/null | grep -q "packages/core/postgrest-js/test/db/"; then
  echo "ğŸ“ Detected changes in postgrest-js test database schema..."
  echo "ğŸ” Checking if generated types are in sync..."

  npm run codegen:check:postgrest

  if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Push blocked: Postgrest generated types are out of sync"
    echo ""
    echo "To fix this:"
    echo "  1. Run: npm run codegen:postgrest"
    echo "  2. Commit the updated test/types.generated.ts"
    echo "  3. Push again"
    echo ""
    exit 1
  fi

  echo "âœ… Postgrest generated types are in sync"
fi
